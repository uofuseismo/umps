<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>UMPS: Utilities</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">UMPS
   </div>
   <div id="projectbrief">The University of Utah Seismograph Stations Message Passing System.</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('group___authentication___utilities.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">Modules</a>  </div>
  <div class="headertitle">
<div class="title">Utilities<div class="ingroups"><a class="el" href="group___authentication__chapter.html">Authentication</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>Programs for interacting adding/updating/removing users from the users table and generating key-pairs.  
<a href="#details">More...</a></p>
<div class="dynheader">
Collaboration diagram for Utilities:</div>
<div class="dyncontent">
<div class="center"><img src="group___authentication___utilities.png" border="0" usemap="#agroup______authentication______utilities" alt=""/></div>
<map name="agroup______authentication______utilities" id="agroup______authentication______utilities">
<area shape="rect" title="Programs for interacting adding/updating/removing users from the users table and generating key&#45;pairs..." alt="" coords="171,5,244,31"/>
<area shape="rect" href="group___authentication___utilities___user_table.html" title="On the server, all user credentials are stored in a single database. This program facilitates interac..." alt="" coords="292,5,383,31"/>
<area shape="rect" href="group___authentication__chapter.html" title=" " alt="" coords="5,5,123,31"/>
</map>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="groups"></a>
Modules</h2></td></tr>
<tr class="memitem:group___authentication___utilities___user_table"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___authentication___utilities___user_table.html">User Table</a></td></tr>
<tr class="memdesc:group___authentication___utilities___user_table"><td class="mdescLeft">&#160;</td><td class="mdescRight">On the server, all user credentials are stored in a single database. This program facilitates interaction with that database. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Programs for interacting adding/updating/removing users from the users table and generating key-pairs. </p>


<h3><a id="TopicAuthentication_Keypairs"></a>Generating Key Pairs</h3><div class="textblock">For users using the Stonehouse security model, you will have to generate a public/private keypair. A standalone program for this activity is uKeyPair. You can get an overview of the program <pre class="fragment"> uKeyPair --help
</pre> However, you probably want to jump right in. So let's make an example <pre class="fragment"> uKeyPair --publickey examplePublicKey.txt --privatekey examplePrivateKey.txt --keyname 'keys for uOperator@example server'
</pre> Here, you are specifying the public and private key file names. Additionally, the keyname argument is a little reminder for yourself should ever read see these files and wonder - to which machine does this key pair actually help me connect? This program should generate your public key (examplePublicKey.txt) and your private key (exmaplePrivateKey.txt). You should also check the permissions on these files to ensure that the public key is read/write/executable by you and only readable by others (644) whereas the private key is only read/write/executable (600) by you. Normally, these files should be installed into <pre class="fragment"> mv examplePublicKey.txt  ${HOME}/.local/share/UMPS/keys
 mv examplePrivateKey.txt ${HOME}/.local/share/UMPS/keys
</pre><p> A script to help you create a public/private key pair might look like </p><pre class="fragment">#!/usr/bin/bash
# Name of the key pair.  Pick something better in real life.
key_name=$(hostname)-${USER}
# The destination to install the keys.  This is the recommended location
# but another sensible directory is ~/.ssh/
destination=${HOME}/.local/share/UMPS/keys
# Ensure the directory exists
if [ ! -d ${destination} ]; then
   mkdir -p ${destination}
fi
public_key=${destination}/${key_name}PublicKey.txt
private_key=${destination}/${key_name}PrivateKey.txt
if [ -e ${public_key} ]; then
   echo "Removing public key: ${public_key}"
   echo "Removing private key: ${private_key}"
fi
# Generate the key pair.  Again, pick a better comment. 
uKeyPair --publickey ${public_key} --privatekey ${private_key} --keyname 'keys for uOperator@example server'
# Permissions should be done by the application but better safe than sorry
chmod 700 ${destination}
chmod 644 ${public_key}
chmod 600 ${private_key}
</pre><p> Next, you must perform the actual key exchange. The algorithm is as follows:<ol type="1">
<li>Connect to the machine running uOperator. Note, this actually requires you to have login credentials on this machine.</li>
<li>Switching users to the user running uOperator.</li>
<li>Copy your <b>public</b> key to ${HOME}/.local/share/UMPS/keys or wherever public keys are installed on the machine running the uOperator. This information should be in the uOperator initialization file.</li>
<li>Download a copy of the the uOperator's <b>public</b> key from ${HOME}/.local/share/UMPS/keys or wherever public keys are installed on the machine running the uOperator.</li>
</ol>
As a specific example, you (or your system administrator) may install your public key on the uOperator machine using </p><pre class="fragment">scp ${HOME}/.local/share/UMPS/keys/THIS_SERVERS_PUBLIC_KEY.txt UOPERATOR_USER@UOPERATOR_SERVER:${HOME}/.local/share/UMPS/keys/
</pre><p> and obtain the uOperator's public key for this machine using </p><pre class="fragment">scp UOPERATOR_USER@UOPERATOR_SERVER:${HOME}/.local/share/UMPS/keys/UOPERATOR_PUBLIC_KEY.txt ${HOME}/.local/share/UMPS/keys/
</pre><p> Lastly, you may still experience a connection issue even after the keys are exchanged and the user is created in the user table. I've found ssh'ing from the remote machine to the machine running UMPS can magically fix things.For users using the Stonehouse security model, you will have to generate a public/private keypair. A standalone program for this activity is uKeyPair. You can get an overview of the program <pre class="fragment"> uKeyPair --help
</pre> However, you probably want to jump right in. So let's make an example <pre class="fragment"> uKeyPair --publickey examplePublicKey.txt --privatekey examplePrivateKey.txt --keyname 'keys for uOperator@example server'
</pre> Here, you are specifying the public and private key file names. Additionally, the keyname argument is a little reminder for yourself should ever read see these files and wonder - to which machine does this key pair actually help me connect? This program should generate your public key (examplePublicKey.txt) and your private key (exmaplePrivateKey.txt). You should also check the permissions on these files to ensure that the public key is read/write/executable by you and only readable by others (644) whereas the private key is only read/write/executable (600) by you. Normally, these files should be installed into <pre class="fragment"> mv examplePublicKey.txt  ${HOME}/.local/share/UMPS/keys
 mv examplePrivateKey.txt ${HOME}/.local/share/UMPS/keys
</pre><p> A script to help you create a public/private key pair might look like </p><pre class="fragment">#!/usr/bin/bash
# Name of the key pair.  Pick something better in real life.
key_name=$(hostname)-${USER}
# The destination to install the keys.  This is the recommended location
# but another sensible directory is ~/.ssh/
destination=${HOME}/.local/share/UMPS/keys
# Ensure the directory exists
if [ ! -d ${destination} ]; then
   mkdir -p ${destination}
fi
public_key=${destination}/${key_name}PublicKey.txt
private_key=${destination}/${key_name}PrivateKey.txt
if [ -e ${public_key} ]; then
   echo "Removing public key: ${public_key}"
   echo "Removing private key: ${private_key}"
fi
# Generate the key pair.  Again, pick a better comment. 
uKeyPair --publickey ${public_key} --privatekey ${private_key} --keyname 'keys for uOperator@example server'
# Permissions should be done by the application but better safe than sorry
chmod 700 ${destination}
chmod 644 ${public_key}
chmod 600 ${private_key}
</pre><p> Next, you must perform the actual key exchange. The algorithm is as follows:<ol type="1">
<li>Connect to the machine running uOperator. Note, this actually requires you to have login credentials on this machine.</li>
<li>Switching users to the user running uOperator.</li>
<li>Copy your <b>public</b> key to ${HOME}/.local/share/UMPS/keys or wherever public keys are installed on the machine running the uOperator. This information should be in the uOperator initialization file.</li>
<li>Download a copy of the the uOperator's <b>public</b> key from ${HOME}/.local/share/UMPS/keys or wherever public keys are installed on the machine running the uOperator.</li>
</ol>
As a specific example, you (or your system administrator) may install your public key on the uOperator machine using </p><pre class="fragment">scp ${HOME}/.local/share/UMPS/keys/THIS_SERVERS_PUBLIC_KEY.txt UOPERATOR_USER@UOPERATOR_SERVER:${HOME}/.local/share/UMPS/keys/
</pre><p> and obtain the uOperator's public key for this machine using </p><pre class="fragment">scp UOPERATOR_USER@UOPERATOR_SERVER:${HOME}/.local/share/UMPS/keys/UOPERATOR_PUBLIC_KEY.txt ${HOME}/.local/share/UMPS/keys/
</pre> </div>

<h3><a id="TopicAuthentication_UserTable"></a>User Table</h3><div class="textblock">Provided you are performing authentication, on the machine that will run the uOperator you must also create a users table. A command line utility for interacting with this table is uUserTable program. An overview of what this program does is obtained with <pre class="fragment"> uUserTable --help
</pre> Users details are specified in a JSON file. For example, let's add user Bob. The corresponding JSON file, bob.json, looks like <pre class="fragment">{
     "name" : "Bob",
     "email" : "bob@university.edu", 
     "password" : null,
     "publickey_file" : "bobsPublicKey.txt",
     "privileges" : "read_write"
}
</pre> At a minimum, we must provide a username and password as these two fields will ultimately constitute a unique user. Additionally, we are providing requisite information for Grasslands, Strawhouse, or Stonehouse authentication; Woodhouse is a username and password verification and the password is not being provided. Generating the public key, bobsPublicKey.txt, is described in <a class="el" href="group___authentication___utilities.html">Generating Key Pairs</a>. Lastly, we note the privileges are "read_write" which will be sufficient for most users. Other choices include "read_only" or "admin" where "read_only" users are typically only interested in subscribing to a data feed and "admin" privileges should be reserved for very special users. <br  />
 To add Bob, we do the following on the uOperator host machine <pre class="fragment">uUserTable --add bob.json
</pre> After the fact, we may wish to allow Bob to use the Woodhouse security protocol but downgrade his privileges to read-only. In this case, we can update his details with a new JSON file, bobUpdate.json, <pre class="fragment">{   
     "name" : "Bob",
     "email" : "bob@university.edu", 
     "password" : "bobsPassword",
     "publickey_file" : "bobsPublicKey.txt",
     "privileges" : "read_only"
}
</pre> We then update this information with <pre class="fragment">uUserTable --update bobUpdate.json
</pre> After some time, Bob may be moving onto greener pastures. In this case, we delete Bob using the following JSON file, bobDelete.json <pre class="fragment">{
     "name" : "Bob",
     "email" : "bob@university.edu"
}
</pre> Lastly, you can check your work <pre class="fragment">sqlite3 ${HOME}/.local/share/UMPS/tables/user.sqlite3
SELECT * FROM user WHERE user = "Bob" AND email = "bob@university.edu";
.quit
</pre><p> where I have implicitly been writing to the default user's table located in ${HOME}/.local/share/UMPS/tables on a Linux system. </div>

<h3><a id="TopicAuthentication_UsersTable"></a>Users Table</h3><div class="textblock">Provided you are performing authentication, on the machine that will run the uOperator you must also create a users table. A command line utility for interacting with this table is uUserTable program. An overview of what this program does is obtained with <pre class="fragment"> uUserTable --help
</pre> Users details are specified in a JSON file. For example, let's add user Bob. The corresponding JSON file, bob.json, looks like <pre class="fragment">{
     "name" : "Bob",
     "email" : "bob@university.edu", 
     "password" : null,
     "publickey_file" : "bobsPublicKey.txt",
     "privileges" : "read_write"
}
</pre> At a minimum, we must provide a username and password as these two fields will ultimately constitute a unique user. Additionally, we are providing requisite information for Grasslands, Strawhouse, or Stonehouse authentication; Woodhouse is a username and password verification and the password is not being provided. Generating the public key, bobsPublicKey.txt, is described in <a class="el" href="group___authentication___utilities.html">Generating Key Pairs</a>. Lastly, we note the privileges are "read_write" which will be sufficient for most users. Other choices include "read_only" or "admin" where "read_only" users are typically only interested in subscribing to a data feed and "admin" privileges should be reserved for very special users. <br  />
 To add Bob, we do the following on the uOperator host machine <pre class="fragment">uUserTable --add bob.json
</pre> After the fact, we may wish to allow Bob to use the Woodhouse security protocol but downgrade his privileges to read-only. In this case, we can update his details with a new JSON file, bobUpdate.json, <pre class="fragment">{   
     "name" : "Bob",
     "email" : "bob@university.edu", 
     "password" : "bobsPassword",
     "publickey_file" : "bobsPublicKey.txt",
     "privileges" : "read_only"
}
</pre> We then update this information with <pre class="fragment">uUserTable --update bobUpdate.json
</pre> After some time, Bob may be moving onto greener pastures. In this case, we delete Bob using the following JSON file, bobDelete.json <pre class="fragment">{
     "name" : "Bob",
     "email" : "bob@university.edu"
}
</pre> Lastly, you can check your work <pre class="fragment">sqlite3 ${HOME}/.local/share/UMPS/tables/user.sqlite3
SELECT * FROM user WHERE user = "Bob" AND email = "bob@university.edu";
.quit
</pre><p> where I have implicitly been writing to the default user's table located in ${HOME}/.local/share/UMPS/tables on a Linux system. </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Oct 15 2024 16:50:21 for UMPS by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
