<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>UMPS: Messages</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">UMPS
   </div>
   <div id="projectbrief">The University of Utah Seismograph Stations Message Passing System.</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('group___messages__chapter.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">Modules</a>  </div>
  <div class="headertitle">
<div class="title">Messages</div>  </div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Collaboration diagram for Messages:</div>
<div class="dyncontent">
<div class="center"><img src="group___messages__chapter.png" border="0" usemap="#agroup______messages____chapter" alt=""/></div>
<map name="agroup______messages____chapter" id="agroup______messages____chapter">
<area shape="rect" href="group___messages___base_class.html" title="The most important class for those who wish to make their own messages." alt="" coords="140,5,315,45"/>
<area shape="rect" title=" " alt="" coords="5,42,92,67"/>
<area shape="rect" href="group___messages___message_formats.html" title="Some common core message formats in UMPS." alt="" coords="159,70,296,95"/>
</map>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="groups"></a>
Modules</h2></td></tr>
<tr class="memitem:group___messages___base_class"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___messages___base_class.html">Abstract Message Base Class</a></td></tr>
<tr class="memdesc:group___messages___base_class"><td class="mdescLeft">&#160;</td><td class="mdescRight">The most important class for those who wish to make their own messages. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group___messages___message_formats"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___messages___message_formats.html">Message Formats</a></td></tr>
<tr class="memdesc:group___messages___message_formats"><td class="mdescLeft">&#160;</td><td class="mdescRight">Some common core message formats in UMPS. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>


<h3><a id="TopicMessages"></a>Messages</h3><div class="textblock">Messages are a fundamental concept in UMPS because they are the things that are ultimately transmitted. A message is two things. Firstly, a message is a data structure (i.e., a class). Secondly, a message is a thing that is transmitted via a messaging protocol (e.g., TCP, IPC, inproc). Consequently, there must exist a mechanism that goes from a byte-based format to a class and vice-versa - a process known as (de)serialization. This may seem strange at first but keep in mind that while your goal as an object-oriented programmer is to manipulate a class, the goal of UMPS is to transmit messages. Therefore, UMPS, to some extent, is like the postal service in that it does not care what is in the box; it just wants to get that box from place A to place B. <br  />
 <br  />
Elaborating further on the duality of a message, understand that messages are classes. This is because classes are collections of items that we interact with when writing programs. Consequently, prior to sending a message, the user must define how the class will express all of its members in a byte-based format. <br  />
 <br  />
The other side of the coin is that messages are a byte-based representation of the elements of the class. A natural way to view a message is as a collection of item-value pairs. Specifically, common mechanisms that express item-value pairs as plain-text are <a href="https://www.json.org/json-en.html">JSON</a> and <a href="https://www.xml.com/">XML</a>. Alternatively, common mechanisms for expressing item-value pairs in a binary format are <a href="https://cbor.io/">CBOR</a> and <a href="https://bsonspec.org/">BSON</a>. Of course, a message need not be an item-value pair. It could be a fixed-format string such as an <a href="http://www.earthwormcentral.org/documentation3/PROGRAMMER/y2k-formats.html">Earthworm message</a>. Regardless of the format, all that matters is that upon receipt of the message, the user must be able to map the byte-based values to the members of a class. Before moving on, the curious reader wonder what underlying format UMPS uses for its provided message classes. The answer to that question is CBOR since CBOR tends to result in smaller message sizes than BSON. <br  />
 <br  />
The link between these two conceptual models of a class is the message abstract base class (shown below). When making a message, you will derive from IMessage class and be forced to implement all the requisite functionality that maps from values of member functions to byte-based representations and back. The IMessage class looks like: <div class="fragment"><div class="line"><span class="preprocessor">#ifndef UMPS_MESSAGE_FORMATS_MESSAGE_HPP</span></div>
<div class="line"><span class="preprocessor">#define UMPS_MESSAGE_FORMATS_MESSAGE_HPP</span></div>
<div class="line"><span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"><span class="keyword">namespace </span>UMPS::MessageFormats</div>
<div class="line">{</div>
<div class="line"><span class="keyword">class </span>IMessage</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">virtual</span> <a class="code" href="class_u_m_p_s_1_1_message_formats_1_1_i_message.html#a51783e2e066c88886d650a80c9719c10">~IMessage</a>();</div>
<div class="line">    [[nodiscard]] <span class="keyword">virtual</span> std::unique_ptr&lt;IMessage&gt; <a class="code" href="class_u_m_p_s_1_1_message_formats_1_1_i_message.html#ac630a0fb41dcd5b86ba4f5d6775e5b0f">clone</a>() <span class="keyword">const</span> = 0;</div>
<div class="line">    [[nodiscard]] <span class="keyword">virtual</span> std::unique_ptr&lt;IMessage&gt; <a class="code" href="class_u_m_p_s_1_1_message_formats_1_1_i_message.html#a95d617b20326ea1f9fc86bf408781499">createInstance</a>() const noexcept = 0;</div>
<div class="line">    [[nodiscard]] virtual std::<span class="keywordtype">string</span> <a class="code" href="class_u_m_p_s_1_1_message_formats_1_1_i_message.html#a2ede6025f6961136a010e1cb26d57ff3">toMessage</a>() const = 0;</div>
<div class="line">    virtual <span class="keywordtype">void</span> <a class="code" href="class_u_m_p_s_1_1_message_formats_1_1_i_message.html#abe358a99aa850a81c61258bc61d44df4">fromMessage</a>(const std::<span class="keywordtype">string</span> &amp;message) = 0;</div>
<div class="line">    virtual <span class="keywordtype">void</span> <a class="code" href="class_u_m_p_s_1_1_message_formats_1_1_i_message.html#abe358a99aa850a81c61258bc61d44df4">fromMessage</a>(const <span class="keywordtype">char</span> *data, <span class="keywordtype">size_t</span> length) = 0;</div>
<div class="line">    [[nodiscard]] virtual std::<span class="keywordtype">string</span> <a class="code" href="class_u_m_p_s_1_1_message_formats_1_1_i_message.html#a10453c6b5763591c919f372a9d95c453">getMessageType</a>() const noexcept = 0;</div>
<div class="line">    [[nodiscard]] virtual std::<span class="keywordtype">string</span> <a class="code" href="class_u_m_p_s_1_1_message_formats_1_1_i_message.html#a44a5a213a84f256db9ad01b3ea2fa572">getMessageVersion</a>() const noexcept = 0;</div>
<div class="line">};</div>
<div class="line">}</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="ttc" id="aclass_u_m_p_s_1_1_message_formats_1_1_i_message_html_a10453c6b5763591c919f372a9d95c453"><div class="ttname"><a href="class_u_m_p_s_1_1_message_formats_1_1_i_message.html#a10453c6b5763591c919f372a9d95c453">UMPS::MessageFormats::IMessage::getMessageType</a></div><div class="ttdeci">virtual std::string getMessageType() const noexcept=0</div></div>
<div class="ttc" id="aclass_u_m_p_s_1_1_message_formats_1_1_i_message_html_a2ede6025f6961136a010e1cb26d57ff3"><div class="ttname"><a href="class_u_m_p_s_1_1_message_formats_1_1_i_message.html#a2ede6025f6961136a010e1cb26d57ff3">UMPS::MessageFormats::IMessage::toMessage</a></div><div class="ttdeci">virtual std::string toMessage() const =0</div><div class="ttdoc">Converts this class to a string representation.</div></div>
<div class="ttc" id="aclass_u_m_p_s_1_1_message_formats_1_1_i_message_html_a44a5a213a84f256db9ad01b3ea2fa572"><div class="ttname"><a href="class_u_m_p_s_1_1_message_formats_1_1_i_message.html#a44a5a213a84f256db9ad01b3ea2fa572">UMPS::MessageFormats::IMessage::getMessageVersion</a></div><div class="ttdeci">virtual std::string getMessageVersion() const noexcept=0</div></div>
<div class="ttc" id="aclass_u_m_p_s_1_1_message_formats_1_1_i_message_html_a51783e2e066c88886d650a80c9719c10"><div class="ttname"><a href="class_u_m_p_s_1_1_message_formats_1_1_i_message.html#a51783e2e066c88886d650a80c9719c10">UMPS::MessageFormats::IMessage::~IMessage</a></div><div class="ttdeci">virtual ~IMessage()</div><div class="ttdoc">Destructor.</div></div>
<div class="ttc" id="aclass_u_m_p_s_1_1_message_formats_1_1_i_message_html_a95d617b20326ea1f9fc86bf408781499"><div class="ttname"><a href="class_u_m_p_s_1_1_message_formats_1_1_i_message.html#a95d617b20326ea1f9fc86bf408781499">UMPS::MessageFormats::IMessage::createInstance</a></div><div class="ttdeci">virtual std::unique_ptr&lt; IMessage &gt; createInstance() const noexcept=0</div><div class="ttdoc">Create a clone of this class.</div></div>
<div class="ttc" id="aclass_u_m_p_s_1_1_message_formats_1_1_i_message_html_abe358a99aa850a81c61258bc61d44df4"><div class="ttname"><a href="class_u_m_p_s_1_1_message_formats_1_1_i_message.html#abe358a99aa850a81c61258bc61d44df4">UMPS::MessageFormats::IMessage::fromMessage</a></div><div class="ttdeci">virtual void fromMessage(const std::string &amp;message)=0</div><div class="ttdoc">Converst this message from a string representation to a class.</div></div>
<div class="ttc" id="aclass_u_m_p_s_1_1_message_formats_1_1_i_message_html_ac630a0fb41dcd5b86ba4f5d6775e5b0f"><div class="ttname"><a href="class_u_m_p_s_1_1_message_formats_1_1_i_message.html#ac630a0fb41dcd5b86ba4f5d6775e5b0f">UMPS::MessageFormats::IMessage::clone</a></div><div class="ttdeci">virtual std::unique_ptr&lt; IMessage &gt; clone() const =0</div><div class="ttdoc">Create a copy of this class.</div></div>
</div><!-- fragment -->Since users will have to implement each method I expound on each item:</p><ul>
<li>toMessage<ul>
<li>This converts the class to a string or byte-stream message. Note, a std::string is a convenient container that can contain binary data so do not feel obligated to use a plain-text format like JSON.</li>
</ul>
</li>
<li>fromMessage<ul>
<li>This reconstitutes a class from the a byte-stream or string message - i.e., it is the inverse operation of the toMessage function.</li>
</ul>
</li>
<li>getMessageType<ul>
<li>This allows the library to figure out which class it is supposed to create. Every message <b>must</b> have a unique name so as to prevent naming collisions and subsequent problems during deserialization. Do not overthink the naming. You already solve this problem when you use namespacing to create unique class names.</li>
<li>The message type is also passed onto ZeroMQ. Loosely speaking, our messages are like emails in that they contain a subject and a body. Specifically, the message type is the subject and the serialized payload is the body of this metaphorical email. MOreover, needing only read the subjects (message type) of the email allows certain components of UMPS to work more efficiently; this will be elaborated on when learning about the pub-sub messaging pattern.</li>
</ul>
</li>
<li>createInstance<ul>
<li>The UMPS messaging interfaces to ZeroMQ return an IMessage abstract base class. But that IMessage really has to correspond to a specific type of message class. By providing the library with a concrete implementation it can deserialize the message into the correct class and allow the API to return a generic abstract base class.</li>
</ul>
</li>
<li>clone<ul>
<li>The IMessage types being returned from our ZeroMQ interfaces need to have all the content that was deserialized from the byte-based representation. Cloning allows us to make sure that information is actually copied to the calling function.</li>
</ul>
</li>
<li>getMessageVersion<ul>
<li>It likely will happen that different components of your system are updated at different times. During these piecemeal changes, your message formats may change slightly. A clever behind-the-scenes parser can use the message version, possibly implemented in a MAJOR.MINOR.REVISION format, to great effect and mitigate deserialization problems.</li>
</ul>
</li>
</ul>
In closing this section, I realize that the IMessage abstract base class seems unusual. But the IMessage is the key enabling technology that allows you or me to create arbitrary messages, send those messages to and from different computers with UMPS, and, upon receipt of those messages, interact with them as normal classes in our applications. The upshot is no more arcane Earthworm messages and no more tearing through QuakeML to extract information. In UMPS, your data structures are the messages. I hope you grow to appreciate this as you make truly distributed applications that interact through well-defined APIs. </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Mar 7 2023 00:33:27 for UMPS by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
